---
title: "The _checkpoint_ Package"
#author: "Stefan Schmidt"
date: "7/24/2020"
output: pdf_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Purpose

Main purpose of the _checkpoint_ package is __reproducibility in R__. This is
achieved by setting up a __frozen repository__. To do this _checkpoint_
modifies the R library path (pointing to a local directory) and changes the
_repos_ option to point to the specified MRAN snapshot.

The reproducibility issue is already solved on DaVinci, since MRAN snapshots
already used. Nevertheless the DaVinci platform benefits from _checkpoint_
usage.


## Expected Benefits

### GxP related work and used packages stored in ClearCase

If your work is GxP related and used packages have to be stored in ClearCase
or another source code repository (together with the whole project directory),
then it is relatively easy to do this with _checkpoint_ by simply defining
the library folder to be stored in you project directory. This can be
accomplished using the `checkpointLocation` parameter:

```{r checkpointLocation, eval=FALSE}
library(checkpoint)
checkpoint('2019-12-11', checkpointLocation='~/project_dir/')
```

In this case it is also an advantage that the R library path is shrunk down
to the location of your R installation and the checkpoint library folder only.
All used packages are then stored in ClearCase (only exception: installation
of base R and recommended packages). And even your R version can be fixed in
your call to the `checkpoint()` function:

```{r R.version, eval=FALSE}
library(checkpoint)
checkpoint('2019-12-11', R.version='3.6.1', checkpointLocation='~/project_dir/')
```


## Possible Issues


## Packages are re-installed to your local checkpoint library

This has PROs and CONNs.

### PROs:

* only __limited number of packages__ contained in your project. Especially
when working GxP related and source code (including used packages) is anyways
checked in to your ClearCase repository.

### CONs:

* local re-installation of packages has to be covered by some kind of
__installation testing__ (even when the packages are available pre-installed
on DaVinci)


## FAQ

### What snapshot dates are recommended?

A suitable snapshot should meet the following criteria:

* _availabiltiy_ - there is not for every day a snapshot available on MRAN.
Valid snapshot dates can be retrieved via `getValidSnapshots()`.
* _intended R version_ - to prevent incompatibilities a snapshot for the used
R version should be chosen.
* _latest bugfixes included_ - in case the R version is fixed (like on
DaVinci), it is reasonable to choose a later snapshot to include a maximum of
package bugfixes available for your R version. 


## Open Questions

### How can non-CRAN be installed reproducibly?

_checkpoint_ internally uses `utils::install.packages()` for package
installation. Can packages from other repositories (BioConductor, GitHub) also
be installed in a reproducible way?

## Download Statistics

```{r downloads, echo=FALSE}
library("ggplot2")
library("dlstats")

x <- cran_stats(c("checkpoint", "switchr", "renv"))

if (!is.null(x)) {
  head(x)
  ggplot(x, aes(end, log(downloads), group = package, color = package)) +
    geom_line() + geom_point(aes(shape = package))
}
```


